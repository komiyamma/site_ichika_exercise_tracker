了解しました！第4章では、**保存したデータを画面に表示**する部分を構築します。これまでで学んだ内容を実際に画面に反映させるために、どのようにデータを読み込み、表示するのかを初心者がつまずかないように解説します。

この章では、**思考の軌跡**を大事にし、「なぜそのステップで実装を進めているのか」「上から下に綺麗に実装しているわけではない」という視点を中心に進めます。

---

# 🌀 **第4章：データの表示と動的な更新** 🐾

## 🌟 **4.1 思考の軌跡：保存したデータを画面に表示する**

これまでで、フォームから運動記録を入力し、**`localStorage`に保存**することができました。次に進むべきステップは、その保存されたデータを**画面に表示**することです。

### **初心者の悩み**：

「フォームからデータを保存するところまではできたけど、保存したデータをどうやって画面に表示するのかが分からない。」

### **制作者の思考の軌跡**：

「保存されたデータを**表示するには、まず`localStorage`からデータを取得**し、それをHTMLに**動的に挿入**する必要がある。**`localStorage`から取得したデータを**リストとして表示するにはどうすればいいか**を考えよう。」

---

## 🌼 **4.2 データを取得して表示するための準備**

### **思考の軌跡**：

「まず最初にやるべきことは、**`localStorage`からデータを取得すること**だ。データが保存されていることを確認したら、それをHTMLに表示するための**テンプレート**を作ろう。」

#### **ステップ1: `localStorage` からデータを取得**

```javascript
// `localStorage`からデータを取得する関数
function loadEntriesFromStorage() {
    const rawData = localStorage.getItem('workoutData');
    return rawData ? JSON.parse(rawData) : []; // データが無ければ空配列を返す
}
```

ここでは、保存されたデータがある場合はそれをJSONとして解析し、配列として取得します。もしデータが無ければ、空の配列を返します。

---

## 🌸 **4.3 取得したデータを画面に表示する**

次に、**取得したデータをHTMLに表示**するために、テーブルの行（`<tr>`）を動的に作成して追加します。**データがある場合はそれを表示し、ない場合は「データがありません」と表示する**ようにしましょう。

### **思考の軌跡**：

「**テーブルにデータを表示するために、取得したデータをループで回し**、そのデータをHTMLに反映させる必要がある。表示する内容をテーブルの行として作成し、**`<tbody>`に追加**していこう。」

#### **ステップ2: テーブルにデータを表示**

```javascript
function renderEntryTable() {
    const entries = loadEntriesFromStorage(); // `localStorage`からデータを取得
    const entryListElement = document.getElementById('list'); // データを挿入する場所

    // データがない場合は「データがありません」と表示
    if (entries.length === 0) {
        entryListElement.innerHTML = '<tr><td colspan="5">データがありません</td></tr>';
        return;
    }

    // データがある場合、テーブルに表示する
    let tableHtml = '';
    for (const entry of entries) {
        tableHtml += `
            <tr>
                <td>${entry.date}</td>
                <td>${entry.type}</td>
                <td class="text-end">${entry.minutes || ''}</td>
                <td class="text-end">${entry.value || ''}</td>
                <td>${entry.note || ''}</td>
            </tr>
        `;
    }

    entryListElement.innerHTML = tableHtml; // テーブルの内容を更新
}
```

### **思考の軌跡**：

「まずはデータが**ない場合に**「データがありません」と表示できるようにして、データがある場合は**テーブルに**行を追加する。これで、**動的にデータを表示**する準備が整う。」

---

## 🌼 **4.4 データ表示を更新するタイミング**

データを表示するのは、**`localStorage`にデータを保存した後**です。そのため、**データを保存した後に表示を更新**する必要があります。

### **思考の軌跡**：

「**データを保存した後に表示を更新**することで、ユーザーがデータを追加した直後にその結果を確認できるようにする。これを**イベントリスナー**で実現しよう。」

#### **ステップ3: 保存後に表示を更新**

```javascript
document.getElementById('entry-form').addEventListener('submit', function(event) {
    event.preventDefault(); // フォームのデフォルト送信を防ぐ

    const entry = getFormData(); // フォームのデータを取得
    saveDataToLocalStorage(entry); // `localStorage`にデータを保存

    renderEntryTable(); // データを表示するためにテーブルを更新

    // フォームをリセットして、次の入力ができるようにする
    document.getElementById('entry-form').reset();
});
```

### **思考の軌跡**：

「フォームのデータを保存した後に、テーブルを**再描画**することで、保存したデータがすぐに表示されるようになる。」

---

## 🌸 **4.5 初期表示時にデータを表示する**

ページを読み込んだ際に、**最初に保存されているデータを表示**するようにします。これにより、ユーザーが**アプリを開いたときにすぐにデータを見ることができる**ようになります。

### **思考の軌跡**：

「ページを読み込んだときに、**保存されているデータがあれば**それを表示する処理を追加しよう。ページが最初に読み込まれたときに、`renderEntryTable`を呼び出す。」

#### **ステップ4: ページが読み込まれたときに表示**

```javascript
document.addEventListener('DOMContentLoaded', function() {
    renderEntryTable(); // ページ読み込み時にテーブルを更新
});
```

### **思考の軌跡**：

「ページが最初に読み込まれたときに、**保存されているデータをすぐに表示**できるようにする。」

---

## 🌼 **4.6 まとめと次のステップ**

この章では、**`localStorage`からデータを取得してテーブルに表示**する方法を学びました。次回は、**データの削除機能**や**データの編集機能**を追加することを考えますが、今回は「表示」に集中して取り組みました。

### **重要なポイント**：

* **`localStorage`からデータを取得**し、**動的にテーブルに表示**する方法を理解しました。
* データが**保存された後**、**表示を更新する**タイミングを適切に設定することが大事です。
* **初期表示時にデータを表示**できるように、ページ読み込み時に表示を更新する処理を追加しました。

---

これで**第4章**は終了です！次回は、**保存されたデータを削除する機能や編集機能**を実装していきます。





了解しました！では、**第1章から第4章までの全体のJavaScriptコード**を順に提示いたします。ここまでのすべてのコードをまとめたものです。

---

# **全体のJavaScriptコード**

```javascript
// 入力フォームからデータを取得する関数
function getFormData() {
    const type = document.getElementById('type').value;
    const date = document.getElementById('date').value;
    const minutes = parseInt(document.getElementById('minutes').value, 10) || 0;
    const value = parseInt(document.getElementById('value').value, 10) || 0;
    const note = document.getElementById('note').value.trim();

    // データをオブジェクトとして返す
    return {
        id: generateEntryId(),
        date: date,
        type: type,
        minutes: minutes,
        value: value,
        note: note,
        createdAt: Date.now()
    };
}

// 一意なIDを生成する関数（ミリ秒単位で一意なID）
function generateEntryId() {
    return String(Date.now());
}

// `localStorage`から運動記録データを取得する関数
function loadEntriesFromStorage() {
    const rawData = localStorage.getItem('workoutData');
    return rawData ? JSON.parse(rawData) : []; // データが無ければ空配列を返す
}

// `localStorage`に運動記録データを保存する関数
function saveDataToLocalStorage(entry) {
    const entries = loadEntriesFromStorage(); // 既存データを読み込む
    entries.push(entry); // 新しいデータを配列に追加
    localStorage.setItem('workoutData', JSON.stringify(entries)); // 保存
}

// フォーム送信時にデータを取得し、`localStorage`に保存する処理
document.getElementById('entry-form').addEventListener('submit', function(event) {
    event.preventDefault(); // フォームのデフォルト送信動作を防ぐ

    const entry = getFormData(); // フォームのデータを取得
    saveDataToLocalStorage(entry); // `localStorage`にデータを保存

    renderEntryTable(); // データを表示するためにテーブルを更新

    // フォームをリセットして、次の入力ができるようにする
    document.getElementById('entry-form').reset();
});

// データを画面に表示する関数
function renderEntryTable() {
    const entries = loadEntriesFromStorage(); // `localStorage`からデータを取得
    const entryListElement = document.getElementById('list'); // データを挿入する場所

    // データがない場合は「データがありません」と表示
    if (entries.length === 0) {
        entryListElement.innerHTML = '<tr><td colspan="5">データがありません</td></tr>';
        return;
    }

    // データがある場合、テーブルに表示する
    let tableHtml = '';
    for (const entry of entries) {
        tableHtml += `
            <tr>
                <td>${entry.date}</td>
                <td>${entry.type}</td>
                <td class="text-end">${entry.minutes || ''}</td>
                <td class="text-end">${entry.value || ''}</td>
                <td>${entry.note || ''}</td>
            </tr>
        `;
    }

    entryListElement.innerHTML = tableHtml; // テーブルの内容を更新
}

// ページが読み込まれた際に、保存されたデータを表示する
document.addEventListener('DOMContentLoaded', function() {
    renderEntryTable(); // ページ読み込み時にテーブルを更新
});
```

### 🔍 **実際の `index.html` / `script.js` では…？**

ここまでのサンプルでも `tbody id="list"` を使っており、`index.html` と同じ ID を参照しています。ただし、完成版の `script.js` では

```javascript
entryListElement = document.getElementById('list');
totalCountElement = document.getElementById('total-count');
```

のように要素参照をまとめています。さらに、日付フィルタ入力（`#filter-date`）や件数表示、`Delete` ボタン（`btn btn-sm btn-outline-danger`）といった UI が追加されています。実際のソースを見ながら、まずは `totalCountElement` の更新やフィルタ処理など、気になるところから少しずつ取り入れていくと、無理なく完成形に近づけますよ。

---

### **コードの詳細説明**：

1. **`getFormData`**：

   * フォームの入力フィールド（運動種目、日付、時間、回数、メモ）からデータを取得し、オブジェクトとして返します。

2. **`generateEntryId`**：

   * 運動記録に一意のIDを付与するために、`Date.now()`（現在の時刻）を利用して一意なIDを作成します。

3. **`loadEntriesFromStorage`**：

   * `localStorage`から運動記録データを読み込みます。データが無ければ空の配列を返します。

4. **`saveDataToLocalStorage`**：

   * `localStorage`に運動記録データを保存します。保存する前に、既存のデータを読み込み、新しいデータを追加して再保存します。

5. **フォーム送信時の処理**：

   * フォームが送信されたとき、データを取得して`localStorage`に保存し、その後保存したデータを表示するために**テーブルを更新**します。

6. **`renderEntryTable`**：

   * `localStorage`からデータを取得し、それをHTMLのテーブルに動的に表示します。データがない場合は「データがありません」と表示し、データがある場合はテーブル行として表示します。

7. **`DOMContentLoaded`イベント**：

   * ページが読み込まれたときに、**保存されたデータをすぐに表示**するため、`renderEntryTable`を実行します。

---

### **まとめ**：

* **第1章から第4章**にわたって、フォームで入力した運動記録を**`localStorage`に保存**し、ページに**動的に表示する**仕組みを作りました。
* 今後は、**データの削除機能や編集機能**などを追加して、アプリケーションをさらに拡張していくことができます。

これで、**第4章までのJavaScriptコード全体**を提示しました。次のステップに進んでいく準備が整いました！
