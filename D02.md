# 🪄 Day 2：データが消えない魔法？`localStorage`を使ってみよう 🐾

## 🤔💭「ページを更新したら、全部消えちゃった！」

Day 1で、私たちは「入力フォーム」「ボタン」「表示エリア」があれば、アプリの骨格が作れそうだねって話をしました。そして、JavaScriptを使えば、ボタンを押したときに入力内容を表示エリアに移すこともできそう、と考えました。

でも、ここで大きな問題にぶつかります。

「JavaScriptで入力内容を画面のリストに追加する処理は書けそう…。でも、待って？もしブラウザの更新ボタン（F5）を押したら、せっかく追加したリストが全部消えちゃうんじゃないかな…？😭」

その通りなんです。JavaScriptで作った画面上の表示は、ページを更新すると、まるで夢だったかのように全部リセットされてしまいます。これでは「記録」アプリとしては致命的ですよね。

## 🔍💭「データを『保存』するにはどうしたらいいの？」

「ブラウザを閉じても、ちゃんとデータが残っているようにするには、どうすればいいんだろう？」

*   **初心者の心の声**：「サーバーとか、データベースとか、なんだか難しそうなものが必要なのかな…？もっと気軽に試せる方法はないの？」
*   **検索するときのキーワード**：「ブラウザ データ 保存 JavaScript」「javascript データ 消えないようにする」
*   **そして発見！**：「お！なんだか **`localStorage`（ローカルストレージ）** っていうものがあるらしい！これを使えば、ブラウザ自体にデータを保存できるみたい！」

この `localStorage` こそが、今回私たちが探していた「データが消えない魔法」の正体なんです✨

## 📖 `localStorage`ってなに？

`localStorage`は、一言でいうと「**ブラウザの中にある、自分専用の小さな保管ボックス**」みたいなものです。ここに入れたデータは、自分で「いらない！」って消したり、ブラウザのお掃除機能（キャッシュクリア）を使ったりしない限り、ずっとそこにあり続けます。

この保管ボックスは、**「キー」と「値」のペア**でデータを管理します。まるで、荷物に「イチカどんの運動記録（キー）」っていう名前のラベルを貼って、箱（保管ボックス）にしまっておくようなイメージです。

### 基本的な使い方

使い方は、びっくりするくらいシンプルです。基本はたったの2つ！

1.  **データを保存する：`setItem()`**

    ```javascript
    // 保存に使うキー（ラベル名）を定数（名前が変わらない変数）にしておくと、
    // タイプミスを防げて便利だよ！
    const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';

    // 'ichikaWorkoutLogEntries'っていう名前のラベルを貼って、データを保存！
    localStorage.setItem(WORKOUT_STORAGE_KEY, '[{"type":"ランニング"}]');
    ```

2.  **データを取り出す：`getItem()`**

    ```javascript
    // 保存した時と同じキーを使って、データを取り出します。
    const data = localStorage.getItem(WORKOUT_STORAGE_KEY);
    console.log(data); // '[{"type":"ランニング"}]' って表示されるよ！
    ```

## ⚠️ 超重要！`localStorage`のたった一つのルール

`localStorage`には、一つだけ大切なルールがあります。それは「**文字列しか保存できない**」ということです。

「え、じゃあ、『運動の種類：筋トレ、時間：30分』みたいな複数の情報（オブジェクト）はどうやって保存するの？」

ここで、もう一つの魔法の呪文 `JSON` が登場します！

*   `JSON.stringify()`：オブジェクトや配列を、保存できる**文字列に変換**する呪文。「オブジェクトよ、文字列になれ～！」
*   `JSON.parse()`：文字列になってしまったデータを、元の**オブジェクトや配列に戻す**呪文。「文字列よ、オブジェクトに戻れ～！」

ここでもさっきの定数を使うと、キーの打ち間違いがなくなって、コードがもっと安全になりますよ。

```javascript
const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';
const workout = { type: '筋トレ', time: 30 };

// 1. オブジェクトをJSON文字列に変換して保存
const jsonString = JSON.stringify(workout);
localStorage.setItem(WORKOUT_STORAGE_KEY, jsonString);

// 2. 取り出して、オブジェクトに戻す
const savedString = localStorage.getItem(WORKOUT_STORAGE_KEY);
const savedWorkout = JSON.parse(savedString);

console.log(savedWorkout.type); // '筋トレ' ってちゃんと表示される！
```

この2つの呪文を覚えれば、ちょっと複雑なデータも自由に `localStorage` へ出し入れできるようになります！最強ですね！

## 🔄 やってみよう！保存と読み込みのサイクルを体験する

では、実際に「保存」と「読み込み」を試して、データが本当に消えないか確認してみましょう。ここでは、ページが開かれたときにデータを読み込んで、コンソールに表示する、という簡単な例で試します。

```javascript
const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';

// --- 読み込む側の処理（ページが開かれた時に自動で動く部分）---
document.addEventListener('DOMContentLoaded', () => {
  // localStorageからデータを取り出してみる
  const savedJson = localStorage.getItem(WORKOUT_STORAGE_KEY);

  if (savedJson) {
    // データがあった場合
    console.log('わーい！保存されてたデータが見つかったよ！');
    // JSON文字列をオブジェクトに戻して、見やすく表示
    console.log(JSON.parse(savedJson));
  } else {
    // データがなかった場合
    console.log('保管ボックスは空っぽでした。');
  }
});

// --- 保存する側の処理（あとでコンソールから手動で呼び出して試すよ）---
function saveSampleData() {
  const sampleData = [
    { id: 1, type: 'ランニング', time: 30 },
    { id: 2, type: '筋トレ', time: 45 }
  ];

  // オブジェクトをJSON文字列に変換して保存！
  localStorage.setItem(WORKOUT_STORAGE_KEY, JSON.stringify(sampleData));
  console.log('サンプルデータを保存しました！ページをリフレッシュして確認してみてね。');
}

// --- データをリセットするための関数（お掃除用）---
function clearSavedData() {
  localStorage.removeItem(WORKOUT_STORAGE_KEY);
  console.log('データをリセットしました。ページをリフレッシュしてください。');
}
```

### 試してみる手順 📝

1.  ブラウザでHTMLファイルを開いて、開発者ツール（F12キー）のコンソールを開きます。
2.  **（準備）まずはお掃除！** コンソールに `clearSavedData()` と入力してEnterキーを押し、データを一度リセットします。
3.  ブラウザをリフレッシュ（F5キー）します。コンソールに「保管ボックスは空っぽでした。」と表示されることを確認します。（これで準備OK！✨）
4.  次に、コンソールで `saveSampleData()` と入力してEnterキーを押し、サンプルデータを保存します。
5.  **もう一度ブラウザをリフレッシュ（F5キー）します。**
6.  今度はコンソールに「わーい！保存されてたデータが見つかったよ！」と表示され、保存したデータがちゃんと表示されれば大成功です！🎉

この手順なら、何度でも繰り返し試すことができますね。

## ✨ Day 2 のまとめ

これで、ページを更新してもデータが消えないようにするための、強力な武器を手に入れました！

1.  ブラウザには `localStorage` という便利な保管ボックスがある。
2.  `setItem()` で保存して、`getItem()` で取り出せる。
3.  キー（ラベル名）は定数にしておくと、タイプミスが防げて安全。
4.  オブジェクトはそのまま保存できないから、`JSON.stringify()` と `JSON.parse()` を使って、文字列とオブジェクトを行き来させる。

次のDay 3からは、この `localStorage` を使って、実際にデータの保存機能をアプリに組み込んでいきましょう！