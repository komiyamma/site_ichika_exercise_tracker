# 🪄 第2章：データが消えない魔法？`localStorage`入門 🐾

## 🤔 思考の軌跡：ページを更新したら、全部消えちゃった！

第1章で、私たちは「入力フォーム」「ボタン」「表示エリア」があれば、アプリの骨格が作れそうだと考えました。そして、JavaScriptを使えば、ボタンを押したときに入力内容を表示エリアに移す、ということもできそうです。

でも、ここで大きな問題にぶつかります。

「JavaScriptで入力内容を画面のリストに追加する処理は書けそうだな。…でも、待てよ？もしブラウザの更新ボタン（F5）を押したら、そのリストって全部消えちゃうんじゃないかな…？😭」

その通りです。JavaScriptで作った画面上の表示は、ページを更新するとリセットされてしまいます。せっかく記録しても、消えてしまっては意味がありません。これでは「記録」アプリとしては致命的です。

## 🔍 思考の軌跡：データを「保存」するには？

「どうすれば、ブラウザを閉じてもデータが残っているようにできるんだろう？」

*   **初心者の想像** ：「サーバーとか、データベースとかいう難しそうなものが必要なのかな…？もっと手軽に試せる方法はないの？」
*   **検索キーワード** ：「ブラウザ データ 保存 JavaScript」「javascript データ 消えないようにする」
*   **発見** ：「お！なんだか **`localStorage`（ローカルストレージ）** というものがあるらしい！これを使えば、ブラウザ自体にデータを保存できるみたい！」

この `localStorage` こそが、今回私たちが探していた「データが消えない魔法」の正体です。

## 📖 `localStorage`ってなに？

`localStorage` は、一言でいうと「 **ブラウザの中にある、小さな自分専用の保管庫** 」です。ここに入れたデータは、ユーザーが手動で消したり、ブラウザのキャッシュをクリアしたりしない限り、ずっとそこにあり続けます。

この保管庫は、 **「キー」と「値」のペア** でデータを管理します。まるで、荷物に「名前のラベル（キー）」を貼って、箱（保管庫）にしまっておくようなイメージです。

### 基本的な使い方

使い方は、驚くほどシンプルです。基本はたったの2つ！

1.  **データを保存する：`setItem()`**

    ```javascript
    // 保存に使うキー（ラベル名）を定数にしておくと、タイプミスを防げて便利です。
    const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';

    // WORKOUT_STORAGE_KEYという名前のラベルを貼ってデータを保存
    localStorage.setItem(WORKOUT_STORAGE_KEY, '[{"type":"ランニング"}]');
    ```

2.  **データを取り出す：`getItem()`**

    ```javascript
    // 保存した時と同じキーを使ってデータを取り出します
    const data = localStorage.getItem(WORKOUT_STORAGE_KEY);
    console.log(data); // '[{"type":"ランニング"}]'
    ```

## ⚠️ 超重要！`localStorage`のルール

`localStorage`には、一つだけ大切なルールがあります。それは「 **文字列しか保存できない** 」ということです。

「え、じゃあ、運動の記録みたいな複数の情報（オブジェクト）はどうやって保存するの？」

ここで、もう一つの魔法の呪文 `JSON` が登場します。

*   `JSON.stringify()`：オブジェクトや配列を、保存できる **文字列に変換** する呪文。
*   `JSON.parse()`：文字列になってしまったデータを、元通りの **オブジェクトや配列に戻す** 呪文。

ここでも先ほどの定数を使うことで、キーの書き間違いを防ぎ、コードの信頼性を高めることができます。

```javascript
const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';
const workout = { type: '筋トレ', time: 30 };

// 1. オブジェクトをJSON文字列に変換して保存
const jsonString = JSON.stringify(workout);
localStorage.setItem(WORKOUT_STORAGE_KEY, jsonString);

// 2. 取り出して、オブジェクトに戻す
const savedString = localStorage.getItem(WORKOUT_STORAGE_KEY);
const savedWorkout = JSON.parse(savedString);

console.log(savedWorkout.type); // '筋トレ'
```

この2つの呪文を覚えれば、複雑なデータも自由に `localStorage` へ出し入れできるようになります！

## 🔄 やってみよう：保存とロードのサイクルを体感する

では、実際に「保存」と「読み込み」を試して、データが消えないことを確認してみましょう。ここでは、ページが開かれたときにデータを読み込み、コンソールに表示する、という簡単な例で試します。

```javascript
const WORKOUT_STORAGE_KEY = 'ichikaWorkoutLogEntries';

// --- 読み込む側の処理（ページが開かれた時に実行される）---
document.addEventListener('DOMContentLoaded', () => {
  // localStorageからデータを取り出す
  const savedJson = localStorage.getItem(WORKOUT_STORAGE_KEY);

  if (savedJson) {
    console.log('保存されていたデータが見つかりました！');
    // JSON文字列をオブジェクトに戻して表示
    console.log(JSON.parse(savedJson));
  } else {
    console.log('保存されているデータはありませんでした。');
  }
});

// --- 保存する側の処理（開発者ツールなどで手動実行して試す）---
function saveSampleData() {
  const sampleData = [
    { id: 1, type: 'ランニング', time: 30 },
    { id: 2, type: '筋トレ', time: 45 }
  ];

  // オブジェクトをJSON文字列に変換して保存
  localStorage.setItem(WORKOUT_STORAGE_KEY, JSON.stringify(sampleData));
  console.log('サンプルデータを保存しました！ページをリフレッシュして確認してみてください。');
}

// --- データをリセットする関数 ---
function clearSavedData() {
  localStorage.removeItem(WORKOUT_STORAGE_KEY);
  console.log('データをリセットしました。ページをリフレッシュしてください。');
}
```

### 試してみる手順

1.  ブラウザでHTMLファイルを開き、開発者ツール（F12）のコンソールを開きます。
2.  **（準備）まずはお掃除！** コンソールに `clearSavedData()` と入力してエンターキーを押し、データを一度リセットします。
3.  ブラウザをリフレッシュ（F5）します。コンソールに「保存されているデータはありませんでした。」と表示されることを確認します。（これで準備OKです！✨）
4.  次に、コンソールで `saveSampleData()` と入力してエンターキーを押し、サンプルデータを保存します。
5.  **もう一度ブラウザをリフレッシュ（F5）します。**
6.  今度はコンソールに「保存されていたデータが見つかりました！」と表示され、保存したデータがオブジェクトとして表示されれば成功です！🎉

この手順なら、何度でも繰り返し試すことができますね。

## ✨ 第2章での結論

これで、ページを更新してもデータが消えないようにするための強力な武器を手に入れました。

1.  ブラウザには `localStorage` という便利な保管庫がある。
2.  `setItem()` で保存し、`getItem()` で取り出せる。
3.  キーは定数にしておくと、タイプミスなどが防げて安全。
4.  オブジェクトはそのまま保存できないので、`JSON.stringify()` と `JSON.parse()` を使って文字列との変換を行う。

次の章からは、この `localStorage` を使って、実際にデータの保存機能をアプリに組み込んでいきましょう！