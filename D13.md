# 🐾 第13章：いよいよ完成へ！やさしい最終チェックガイド 🐾# 🐾 第13章：いよいよ完成へ！やさしい最終チェックガイド 🐾



ここまで本当にお疲れさまです。  ここまで本当にお疲れさまです。  

第11章までで、フォームの保存・一覧表示・削除・日付フィルターがそろいました。  第11章までで、フォームの保存・一覧表示・削除・日付フィルターがそろいました。  

この章では **「第11章で作ったコード」** と **「完成版の `script.js`」** を見比べながら、  この章では **「第11章で作ったコード」** と **「完成版の `script.js`」** を見比べながら、  

「最後の仕上げで何が増えたのか」をゆっくり確認していきます。「最後の仕上げで何が増えたのか」をゆっくり確認していきます。



> 想定している読者：プログラミング学習 3 ヶ月／JavaScript と HTML・CSS を始めて間もない方。  > 想定している読者：プログラミング学習 3 ヶ月／JavaScript と HTML・CSS を始めて間もない方。  

> ステップごとに確認できるよう、Console で試せるポイントも書いてあります。> ステップごとに確認できるよう、Console で試せるポイントも書いてあります。



------



## 🔄 Step 1 ─ フォーム送信時のちょっとした気配り## 🔄 Step 1 ─ フォーム送信時のちょっとした気配り



### Step 1 変化ポイント### Step 1 の変化ポイント



- `handleFormSubmit` で、`type` と `date` が空のときに `alert` を出して保存しないようになりました。- `handleFormSubmit` で、`type` と `date` が空のときに `alert` を出して保存しないようになりました。



```javascript```javascript

if (!entry.type || !entry.date) {if (!entry.type || !entry.date) {

    alert('種類と日付は必須です。');    alert('種類と日付は必須です。');

    return;    return;

}}

``````



### Step 1 理由### Step 1 の理由



- 空のまま保存すると「何の記録？」と後から困ってしまうので、最初に気づいてもらう仕組みです。- 空のまま保存すると「何の記録？」と後から困ってしまうので、最初に気づいてもらう仕組みです。



### Step 1 確認ポイント### Step 1 の確認ポイント



1. `種類` と `日付` を空のまま登録ボタンを押してみる。1. `種類` と `日付` を空のまま登録ボタンを押してみる。

2. アラートが表示されるか、`localStorage` に変なデータが増えていないか確認。  2. アラートが表示されるか、`localStorage` に変なデータが増えていないか確認。

   - Console で `loadEntriesFromStorage()` と入力すると保存済み配列が見えます。    - Console で `loadEntriesFromStorage()` と入力すると保存済み配列が見えます。



------



## 🔄 Step 2 ─ `localStorage` の失敗に備える## 🔄 Step 2 ─ `localStorage` の失敗に備える



### Step 2 変化ポイント### Step 2 の変化ポイント



- `loadEntriesFromStorage` / `saveEntriesToStorage` に `try...catch` が追加されました。- `loadEntriesFromStorage` / `saveEntriesToStorage` で `try...catch` が追加されました。



```javascript```javascript

function loadEntriesFromStorage() {function loadEntriesFromStorage() {

    try {    try {

        const entriesJson = localStorage.getItem(WORKOUT_STORAGE_KEY);        const entriesJson = localStorage.getItem(WORKOUT_STORAGE_KEY);

        return entriesJson ? JSON.parse(entriesJson) : [];        return entriesJson ? JSON.parse(entriesJson) : [];

    } catch (e) {    } catch (e) {

        console.error('ストレージからのデータ読み込みに失敗しました:', e);        console.error('ストレージからのデータ読み込みに失敗しました:', e);

        return [];        return [];

    }    }

}}

``````



### Step 2 理由### Step 2 の理由



- ブラウザの設定や容量の状況によっては `localStorage` が使えないことがあります。そのときアプリが止まらないようにするためです。> ⚠️ メモ：たとえばプライベートブラウズ中の Safari では `localStorage` への書き込みが禁止されており、そのまま `JSON.parse` しようとすると例外が投げられます。`try...catch` が無いと処理が途中で止まり、画面が更新されなくなります。`catch` の中で空の配列を返してログに残しておけば、「保存はできなかったけれどアプリは動き続ける」という安全策をとれます。



> ⚠️ メモ：たとえばプライベートブラウズ中の Safari では `localStorage` への書き込みが禁止されており、そのまま `JSON.parse` しようとすると例外が投げられます。`try...catch` が無いと処理が途中で止まり、画面が更新されなくなります。`catch` の中で空の配列を返してログに残しておけば、「保存はできなかったけれどアプリは動き続ける」という安全策をとれます。### Step 2 の確認ポイント



### Step 2 確認ポイント- 普段はエラーにならないので直接再現は難しいですが、コードを読んで「失敗しても空の配列を返すから大丈夫なんだな」と理解しておくのが大切です。



- 普段はエラーにならないので直接再現は難しいですが、コードを読んで「失敗しても空の配列を返すから大丈夫なんだな」と理解しておくのが大切です。---



---## 🔄 Step 3 ─ 日付入力を今日の日付でスタート



## 🔄 Step 3 ─ 日付入力を今日の日付でスタート**Step 3 の変化ポイント**



### Step 3 変化ポイント- `initializePage` 内で `dateInputElement.value = formatDateForInput(getTodayString());` が呼ばれるようになりました。

- `getTodayString` や `formatDateForInput` といった補助関数が増えています。

- `initializePage` 内で `dateInputElement.value = formatDateForInput(getTodayString());` が呼ばれるようになりました。

- `getTodayString` や `formatDateForInput` といった補助関数が増えています。**Step 3 の理由**



### Step 3 理由- フォームを開くたびに日付を選ぶのはちょっと面倒。今日の日付が最初から入っていると嬉しいですよね。



- フォームを開くたびに日付を選ぶのはちょっと面倒。今日の日付が最初から入っていると嬉しいですよね。**Step 3 の確認ポイント**



### Step 3 確認ポイント1. ページをリロードして、日付欄が自動的に今日の日付になっているか見る。

2. Console で `getTodayString()` や `formatDateForInput('20240101')` を呼んで、どんな形式で返るか試す。

1. ページをリロードして、日付欄が自動的に今日の日付になっているか見る。

2. Console で `getTodayString()` や `formatDateForInput('20240101')` を呼んで、どんな形式で返るか試す。---



---## 🔄 Step 4 ─ デバッグ用「全部消す」ボタンの追加



## 🔄 Step 4 ─ デバッグ用「全部消す」ボタンの追加**Step 4 の変化ポイント**



### Step 4 変化ポイント- 開発中に便利な「Debug: 全削除」ボタン (`debug-clear-storage`) が追加されました。

- `handleDebugClearStorageClick` で確認ダイアログ → 削除 → `renderEntryTable()` まで一括で行います。

- 開発中に便利な「Debug: 全削除」ボタン (`debug-clear-storage`) が追加されました。

- `handleDebugClearStorageClick` で確認ダイアログ → 削除 → `renderEntryTable()` まで一括で行います。```javascript

function handleDebugClearStorageClick() {

```javascript    const message = 'localStorage の「このアプリ関連」の「記録データ全て」を削除します。よろしいですか？';

function handleDebugClearStorageClick() {    if (!window.confirm(message)) {

    const message = 'localStorage の「このアプリ関連」の「記録データ全て」を削除します。よろしいですか？';        return;

    if (!window.confirm(message)) {    }

        return;

    }    localStorage.removeItem(WORKOUT_STORAGE_KEY);

    filterDateInputElement.value = '';

    localStorage.removeItem(WORKOUT_STORAGE_KEY);    renderEntryTable();

    filterDateInputElement.value = '';    window.alert('データを削除しました。');

    renderEntryTable();}

    window.alert('データを削除しました。');```

}

```**Step 4 の理由**



### Step 4 理由- 学習中にテストデータを一度リセットしたい場面がよくあるからです。  

    ※本番アプリでは開発者だけ使える場所に置くことが多いです。

- 学習中にテストデータを一度リセットしたい場面がよくあるからです。  

  ※本番アプリでは開発者だけ使える場所に置くことが多いです。**Step 4 の確認ポイント**



### Step 4 確認ポイント1. ボタンを押してダイアログが出るか確認。

2. OK を押したら一覧が空になり、件数も 0 になっているかを見る。

1. ボタンを押してダイアログが出るか確認。3. `localStorage` ビュー（ブラウザ開発者ツール）でもキーが削除されているかチェック。

2. OK を押したら一覧が空になり、件数も 0 になっているかを見る。

3. `localStorage` ビュー（ブラウザ開発者ツール）でもキーが削除されているかチェック。---



---## 🔄 Step 5 ─ `renderEntryTable` をパワーアップ



## 🔄 Step 5 ─ `renderEntryTable` をパワーアップ第11章の時点でもテーブル表示はできていましたが、最終版では以下のような改善が加わっています。



第11章の時点でもテーブル表示はできていましたが、最終版では以下のような改善が加わっています。| 改善点 | 目的 | 確認のコツ |

|--------|------|------------|

| 改善点 | 目的 | 確認のコツ || `filter-date` の値を使って `entries.filter(...)` | 日付フィルタを反映する | フィルタを変えたときの `console.log('[renderEntryTable] filteredEntries:', ...)` を見る |

|--------|------|------------|| `filteredEntries.sort((a, b) => b.createdAt - a.createdAt)` | 新しい記録を上に | 新しく登録した記録が一番上に来るかチェック |

| `filter-date` の値を使って `entries.filter(...)` | 日付フィルタを反映する | フィルタを変えたときの `console.log('[renderEntryTable] filteredEntries:', ...)` を見る || `totalCountElement.textContent` を更新 | 表示件数をラベルで表示 | フィルタ変更や削除で件数が変わるか確認 |

| `filteredEntries.sort((a, b) => b.createdAt - a.createdAt)` | 新しい記録を上に | 新しく登録した記録が一番上に来るかチェック || `escapeHtml()` で内容をエスケープ | HTML 特殊文字を安全に表示 | メモ欄に `<script>` を入れても文字として出るか見る |

| `totalCountElement.textContent` を更新 | 表示件数をラベルで表示 | フィルタ変更や削除で件数が変わるか確認 || Delete ボタンに Bootstrap クラス付与 | 見た目をそろえる | ボタンのサイズ・色が統一されているか確認 |

| `escapeHtml()` で内容をエスケープ | HTML 特殊文字を安全に表示 | メモ欄に `<script>alert('こんにちは！')</script>` と入力しても文字として表示されるか確認 |

| Delete ボタンに Bootstrap クラス付与 | 見た目をそろえる | ボタンのサイズ・色が統一されているか確認 |**Step 5 の補足コード（抜粋）**

```javascript

> 🔐 メモ：`escapeHtml()` を通さずにメモ欄へ `<script>alert('こんにちは！')</script>` と入力すると、ブラウザがスクリプトを実行してしまい、勝手にポップアップが出るなどのトラブルにつながります。`escapeHtml()` は `<` や `>` を安全な文字に変換し、「ただの文字」として画面に置くためのお守りです。完成版では描画前に必ず通して、どんな入力が来てもアプリが壊れないように守っています。const selectedDate = filterDateInputElement.value;

let filteredEntries = entries;

### Step 5 補足コード（抜粋）if (selectedDate) {

    filteredEntries = entries.filter(entry => entry.date === selectedDate);

```javascript}

const selectedDate = filterDateInputElement.value;

let filteredEntries = entries;filteredEntries.sort((a, b) =>  b.createdAt - a.createdAt);

if (selectedDate) {totalCountElement.textContent = String(filteredEntries.length);

    filteredEntries = entries.filter(entry => entry.date === selectedDate);

}// ... ベタ書きではなく escapeHtml を通して描画 ...

```

filteredEntries.sort((a, b) =>  b.createdAt - a.createdAt);

totalCountElement.textContent = String(filteredEntries.length);**Step 5 の確認ポイント**



// ... ベタ書きではなく escapeHtml を通して描画 ...1. `console.log('[renderEntryTable] filteredEntries:', filteredEntries);` の出力を見て、フィルタが効いているか確認。

```2. 新しい記録を追加して、件数と並び順が変わるか見る。

3. メモ欄に特殊文字を入れてみて、期待通りテキスト表示されるか確認。

### Step 5 確認ポイント

---

1. `console.log('[renderEntryTable] filteredEntries:', filteredEntries);` の出力を見て、フィルタが効いているか確認。

2. 新しい記録を追加して、件数と並び順が変わるか見る。## 🔄 Step 6 ─ 全体の UI を整える（Bootstrap など）

3. メモ欄に特殊文字を入れてみて、期待通りテキスト表示されるか確認。

**Step 6 のポイント**

---

- 「ボタンの色やサイズ、入力欄の余白を整えて、使いやすくしたい」

## 🔄 Step 6 ─ 全体の UI を整える（Bootstrap など）- 「Bootstrap のクラス（`btn btn-sm btn-outline-danger` など）を使って統一感を出そう」



### Step 6 変化ポイントHTML と CSS にも手が加わっていますが、ここでは `script.js` の Delete ボタンにクラスを追加している点が主な差分です。  

第12章と合わせて見直すと、最終的な見た目がよく分かります。

- 「ボタンの色やサイズ、入力欄の余白を整えて、使いやすくしたい」という狙いで、Bootstrap のクラス（`btn btn-sm btn-outline-danger` など）が追加されています。

---

### Step 6 理由

## ✔️ これで完成！

- 第12章と合わせて見直すと、最終的な見た目がよく分かります。  

  ここでは `script.js` の Delete ボタンにクラスを追加している点が主な差分です。ここまでの差分を取り入れると、アプリは次のような状態になります。



### Step 6 確認ポイント1. **入力チェック** で変なデータが保存されない  

2. **エラー対策** で予期しない状況でも壊れにくい  

- テーブルのボタンや入力欄の見た目が統一されているかをブラウザで確認します。3. **日付の初期値** が親切で入力がスムーズ  

4. **デバッグ補助** で学習中のリセットが簡単  

---5. **表示ロジックの充実**（フィルタ・並び替え・件数・XSS対策）  

6. **UIの統一感** で操作がしやすくなる

## まとめ

これらをひとつずつ取り込んでいけば、第11章の状態から「完成版 `script.js`」へ気持ちよくたどり着けます。  

1. **入力チェック** で変なデータが保存されない。ぜひ自分の手でも差分を確かめながら、“動く” だけでなく “使いやすい” アプリを完成させてくださいね！

2. **エラー対策** で予期しない状況でも壊れにくい。

3. **日付の初期値** が親切で入力がスムーズ。完成、本当におめでとうございます！ 🎉👏

4. **デバッグ補助** で学習中のリセットが簡単。
5. **表示ロジックの充実**（フィルタ・並び替え・件数・XSS 対策）。
6. **UI の統一感** で操作がしやすい。

これらをひとつずつ取り込んでいけば、第11章の状態から「完成版 `script.js`」へ気持ちよくたどり着けます。  
ぜひ自分の手でも差分を確かめながら、“動く” だけでなく “使いやすい” アプリを完成させてくださいね。

完成、本当におめでとうございます！ 🎉👏
