# 🌿 第5章：要件定義と設計にまとめよう

* **内容** ：第1章〜第4章で体験した学びを踏まえて、運動記録アプリの要件と設計を一枚に整理します。誰が何をしたいのか、最低限必要な機能やデータ構造を明確にします。
* **目的** ：次章以降の実装を迷いなく進められるように、画面・データ・動作のイメージを共有できる状態にすること。

---

## 🎯 5.1 ゴールとユーザーストーリー

ペルソナは、練習量を可視化したい学生アスリート「いちか」。以下のようなストーリーを実現するのがゴールです。

> 1. 今日行ったトレーニング内容をフォームに入力して保存したい。  
> 2. 保存した内容を時系列で眺めながら、必要に応じて削除したい。  
> 3. ある日付に行ったトレーニングだけを素早く振り返りたい。

このゴールが満たされれば、「記録が継続できない」「前回との比較がしづらい」といった悩みを解消できます。

---

## ✅ 5.2 必須となる機能一覧

第1章〜第4章で得た気づきを整理すると、最小構成で実装すべき機能は次の5つです。

1. **記録の追加** ：フォームに入力した内容を保存する。  
2. **記録の一覧表示** ：保存済みデータをテーブルで確認できる。  
3. **記録の削除** ：不要になった行をワンクリックで消せる。  
4. **日付フィルタ** ：指定した日付に絞り込んで表示する（フィルタ解除も用意）。  
5. **永続化** ：ブラウザを閉じても記録が残るように `localStorage` に保存する。

この5つが揃えば、日常的なトレーニング記録アプリとして必要最低限の体験を提供できます。編集機能やグラフ表示などの拡張は、基本機能を固めた後に検討します。

---

## 🖼️ 5.3 画面レイアウトの決定

画面は大きく「入力フォーム」「一覧テーブル」「日付フィルタエリア」の3つに分けます。

- **入力フォーム**  
  - 種目（必須・セレクトボックス）  
  - 日付（必須・日付入力）  
  - 時間（分・数値入力）  
  - 回数／重量（数値入力、任意）  
  - メモ（テキスト入力、任意）  
  - 追加ボタン（フォーム全体を送信）

- **日付フィルタエリア**  
  - 日付ピッカー（絞り込み用）  
  - フィルタ解除ボタン  
  - デバッグ用の全削除ボタン（学習用に残す）  
  - 登録件数カウンター

- **一覧テーブル**  
  - 列：日付 / 種目 / 時間 / 回数・重量 / メモ / 操作（削除ボタン）  
  - 表示順：`createdAt` が新しいものから順に上に並ぶ

このレイアウトであれば、章を追って作成してきたミニサンプル（D03, D04）と連続性を保ちながら、本番仕様へスムーズに移行できます。

---

## 📦 5.4 データ構造とストレージ設計

### 5.4.1 運動記録エントリ
```ts
type WorkoutEntry = {
  id: string;          // 削除に使う一意な ID（createdAt を文字列化したものでも良い）
  date: string;        // "YYYY-MM-DD"
  type: string;        // セレクトボックスで選んだ種目名
  minutes: number;     // 運動時間（分）
  value: number;       // 回数や重量などの数値
  note: string;        // メモ欄
  createdAt: number;   // 追加した瞬間のタイムスタンプ（並び替えと ID 生成に利用）
};
```

### 5.4.2 保存先

- Storage Key：`ichikaWorkoutLogEntries`  
- 形式：`WorkoutEntry[]` を `JSON.stringify` した文字列  
- 取り扱いルール：フォーム送信・削除のたびに `load → mutate → save` の順で操作する

この構造を守れば、第2章で学んだ `localStorage` の制約（文字列のみ保存可能）とも整合します。

---

## 🔄 5.5 操作フロー

1. **初期表示**  
   - `DOMContentLoaded` 時に DOM 参照とイベントをセット。  
   - `localStorage` からデータを読み込み、テーブルを描画。

2. **記録追加**  
   - フォームを `submit` → 入力値をトリム・バリデーション。  
   - `createdAt` と `id` を生成し、配列へ `push` → 保存 → 再描画。  
   - フォームをリセットし、日付入力には当日の値を再セット。

3. **記録削除**  
   - テーブルの「削除」ボタンをクリック → `data-id` を取得。  
   - ID が一致しないエントリだけ残すように配列をフィルタ → 保存 → 再描画。

4. **日付フィルタ**  
   - 日付を選択したら `renderEntryTable` を呼び出し、該当データのみ表示。  
   - 解除ボタンで入力を空にし、全件再描画。

5. **全削除（デバッグ用）**  
   - 確認ダイアログ後に `localStorage.removeItem` を実行。  
   - フィルタ入力とテーブルをリセット。

このフローは D03・D04 で構築したコア動作をそのまま発展させたものです。実装時は各ハンドラがどのデータを読み書きしているかを意識すれば迷いません。

---

## 🧭 5.6 非機能要件・検証項目

- **バリデーション** ：種目と日付は必須。数値入力は 0 以上の整数を想定する。  
- **使用環境** ：デスクトップ／モバイル双方で操作できるよう、後続章でレスポンシブ対応を検討。  
- **データ消失対策** ：`JSON.parse` / `JSON.stringify` で例外が発生した場合は空配列にフォールバックし、コンソールにエラーを出す。  
- **デバッグ** ：学習中は全削除ボタンで状態をリセットできるようにしておく。

---

## ✅ 5.7 まとめ

1. ユーザーが達成したい体験（追加・参照・削除・振り返り）を明文化した。  
2. 最小で必要な機能、画面構成、データ構造を整理した。  
3. 実装時のフローと注意点を共有し、次章以降の作業指針を固めた。

ここまでで「何を作るのか」がクリアになりました。第6章からは、ここで定めた仕様に沿って UI や処理を本格的に形にしていきましょう！
