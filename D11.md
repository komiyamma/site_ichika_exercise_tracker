
## 🔍 第11章：フィルタリング機能 🐾

### 11.1 思考の軌跡：なぜフィルタリングが必要か

これまで、すべてのデータを表示していましたが、データが増えると目的のデータを探しづらくなります。 **フィルタリング機能** を追加して、特定の日付のデータだけを簡単に絞り込めるようにします。

### **初心者の悩み** ：

「データが多くなった時に、どうやって特定のデータを絞り込むの？」

### **制作者の思考の軌跡** ：

「 **日付フィルタ** を使って、特定の日付に一致するデータだけを表示できるようにしよう。まずは、 **日付を入力するフォーム** を作って、その日付に基づいてデータをフィルタリングする。」

---

### 11.2 フィルタフォームの作成

まず、HTMLで **日付入力フォーム** を作り、ユーザーが入力した日付でデータを絞り込めるようにします。

#### **HTML** （フィルタフォーム）

```html
<label for="filter-date">日付で絞り込み:</label>
<input type="date" id="filter-date" name="filter-date">
<button id="clear-filter">フィルタ解除</button>
```

---

### 11.3 JavaScriptでフィルタリング処理

次に、 **日付入力フォーム** からユーザーが入力した日付を **JavaScriptで取得** し、その日付に一致するデータを **`localStorage`から絞り込む** 処理を作成します。

#### **JavaScript** （フィルタリング）

```javascript
// DOMが完全に読み込まれた後にイベントを設定
document.addEventListener('DOMContentLoaded', function() {
    const filterDateInput = document.getElementById('filter-date');
    const clearFilterButton = document.getElementById('clear-filter');
    const entryListElement = document.getElementById('list');

    // 日付フィルタが変更されたときに再描画する
    filterDateInput.addEventListener('change', renderEntryTable);

    // フィルタ解除ボタンがクリックされた時の処理
    clearFilterButton.addEventListener('click', function() {
        filterDateInput.value = ''; // フィルタをリセット
        renderEntryTable(); // テーブルを再描画
    });

    // 初期状態でテーブルを描画
    renderEntryTable();
});

// テーブルを描画する関数
function renderEntryTable() {
    const entries = loadEntriesFromStorage(); // `localStorage`からデータを取得
    const filterDate = document.getElementById('filter-date').value; // 入力されたフィルタ日付を取得

    // 初期状態では全てのデータを表示
    let filteredEntries = entries;

    // 日付フィルタが設定されていれば、その日付に一致するデータだけを絞り込む
    if (filterDate) {
        filteredEntries = entries.filter(function(entry) {
            return entry.date === filterDate;
        });
    }

    const entryListElement = document.getElementById('list');
    let tableHtml = '';

    // フィルタ後にデータがない場合の処理
    if (filteredEntries.length === 0) {
        tableHtml = '<tr><td colspan="5">データがありません</td></tr>';
    } else {
        // データがあればテーブルに表示
        filteredEntries.forEach(function(entry) {
            tableHtml += `
                <tr>
                    <td>${entry.date}</td>
                    <td>${entry.type}</td>
                    <td class="text-end">${entry.minutes || ''}</td>
                    <td class="text-end">${entry.value || ''}</td>
                    <td>${entry.note || ''}</td>
                </tr>
            `;
        });
    }

    entryListElement.innerHTML = tableHtml; // テーブルを更新
}
```

> 🔍 フィルタの挙動に不安があるときは、`filteredEntries` を `console.log` で出力してみましょう。「日付が指定されているときだけ配列が短くなっているかな？」と確認すると安心です。

---

### **コードのポイント** ：

1. **イベントリスナーの設定** ：

   * `filter-date`（日付入力フォーム）に対して、`addEventListener`を使って、ユーザーが入力したときに`renderEntryTable()`を呼び出します。
   * メソッドチェーンを避け、 **変数に格納してから** イベントを登録しました。

2. **フィルタ解除ボタンの処理** ：

   * フィルタ解除ボタンがクリックされると、 **日付入力をリセット** し、再描画する処理を実行します。

3. **データの絞り込み** ：

   * 入力された日付に一致するデータを、 **`filter()`メソッド** を使って絞り込みます。
   * フィルタが設定されていない場合は、 **すべてのデータを表示** します。

### **初心者の悩み** ：

「 **`filter()`** メソッドや **`value`** の使い方がわからない。」

### **制作者の思考の軌跡** ：

「 **`filter()`** メソッドは、配列の中から **特定の条件を満たす要素** を取り出すメソッドです。 **`value`** は、フォームから入力された **値を取得** するためのプロパティです。これらを組み合わせて、 **日付でデータを絞り込む** 処理を行います。」

---

### 11.4 フィルタ解除機能の実装

フィルタリングを解除するためには、 **フィルタ解除ボタン** をクリックしたときに、入力された日付を **リセット** し、 **すべてのデータを再表示** させる必要があります。

```javascript
document.getElementById('clear-filter').addEventListener('click', function() {
    document.getElementById('filter-date').value = ''; // フィルタをリセット
    renderEntryTable(); // テーブルを再描画
});
```

* フィルタ解除ボタンをクリックしたときに、 **日付入力欄をリセット** し、 **再度全てのデータを表示** します。

---

### **まとめ**

この章では、 **フィルタリング機能** を実装するために、次のステップを行いました：

1. **日付入力フォーム** を作成し、ユーザーが **日付を入力** してデータを絞り込めるようにしました。
2. フィルタフォームに入力された日付と、 **`localStorage`に保存されたデータの日付を照らし合わせ** 、一致するデータのみを表示しました。
3. **フィルタ解除ボタン** を作成し、 **簡単にフィルタをリセット** して、すべてのデータを再表示する機能を実装しました。

### **重要なポイント** ：

* **`filter()`** メソッドを使って、 **日付で絞り込んだデータ** を表示しました。
* **`value`** プロパティでフォームから日付を取得し、 **フィルタリング** を行いました。
* 


**フィルタ解除ボタン** で、 **簡単にフィルタをリセット** しました。

---

### 🔍 **実際の `index.html` / `script.js` では…？**

完成版ではフィルタ処理に加えて、一覧件数を表示するために `totalCountElement.textContent` を更新し、各行には `delete-button btn btn-sm btn-outline-danger` を付けた Delete ボタンも描画しています。また `renderEntryTable` では `createdAt` を使って新しい順に並べ替えています。まずはこの章のシンプルな描き方で流れを理解し、慣れてきたら件数表示や Delete ボタンの描画などを少しずつ取り入れてみましょう。

---

次回は、 **最終調整と改善** を行い、アプリを完成させる準備をします。

---

これで第11章：フィルタリング機能は終了です！次回は、 **最終調整と改善** に進んでいきます。
