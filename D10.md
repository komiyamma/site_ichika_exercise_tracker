# 🗑️ 第10章：削除機能の実装 🐾

## 🌟 10.1 思考の軌跡：削除機能が必要な理由

これまで、フォームに入力したデータを **`localStorage`に保存** し、 **画面に表示** してきました。しかし、保存したデータは、必要に応じて **削除** することが求められる場合があります。もしユーザーが **不必要なデータを削除** したい場合、その機能がないと困ってしまいます。

### **初心者の悩み** ：

「 **削除ボタンを作る** ということは分かるけれど、 **クリックしたボタンがどのデータを削除するのか** をどうやって特定するのかが分からない。」

### **制作者の思考の軌跡** ：

「削除ボタンを作る前に、 **どのデータを削除するのかを特定する方法** を考えよう。そのために、削除ボタンに **`data-id`** という属性を使って、削除すべきデータを一意に特定できるようにしよう。その後、ボタンがクリックされたときに、 **`localStorage`からそのデータを削除** する方法を考える。」

---

## 🌼 10.2 削除ボタンの作成

まずは、テーブルに **削除ボタン** を追加することから始めます。これにより、ユーザーがデータを **削除したいときにクリックできるボタン** を提供します。

### **思考の軌跡** ：

「 **テーブルに削除ボタンを追加** し、クリックされたときにそのボタンが **どのデータに対応するかを特定** できるようにしたい。そのためには、ボタンに **`data-id`** を使って、そのボタンがどのデータを削除するかを識別できるようにしよう。」

#### **削除ボタンの追加コード** （テーブル内）：

```javascript
function renderEntryTable() {
    const entries = loadEntriesFromStorage(); // `localStorage`からデータを取得
    const entryListElement = document.getElementById('list'); // データを挿入する場所

    // データがない場合は「データがありません」と表示
    if (entries.length === 0) {
        entryListElement.innerHTML = '<tr><td colspan="5">データがありません</td></tr>';
        return;
    }

    // データがある場合、テーブルに表示する
    let tableHtml = '';  // 空の文字列でテーブルを作り始める
    for (const entry of entries) {
        tableHtml += `
            <tr>
                <td>${entry.date}</td>
                <td>${entry.type}</td>
                <td class="text-end">${entry.minutes || ''}</td>
                <td class="text-end">${entry.value || ''}</td>
                <td>${entry.note || ''}</td>
                <td>
                    <button class="delete-button" data-id="${entry.id}" onclick="removeButtonClick('${entry.id}')">
                        Delete
                    </button>
                </td>
            </tr>
        `;
    }

    entryListElement.innerHTML = tableHtml; // テーブルの内容を更新
}
```

* **`<button class="delete-button" data-id="${entry.id}">Delete</button>`** は、テーブルの各行に削除ボタンを追加するコードです。
* それぞれのボタンに、 **`data-id`** という属性を付けて、 **どのデータを削除するか** を識別できるようにしています。

> 📝 メモ：この削除ボタンは、テーブルを描き直すたびにテンプレート文字列から新しく作り直されています。後から生まれる要素に対して「最初に一括で `addEventListener` しておく」ことは難しいので、どのボタンが押されたのかを毎回探しに行くコードが必要になります。そこで今回だけは `<button ... onclick="removeButtonClick(...)">` と書いて、生成した直後にハンドラをくっ付けています。仕組みを理解したら、親要素から「どのボタンをクリックしたのか探索して拾う」書き方など、別の方法もあります。

### **初心者の悩み** ：

「ボタンに **`data-id`** をつける理由がわからない。」

### **制作者の思考の軌跡** ：

「削除ボタンに **`data-id`** を付けることで、クリックされたボタンがどのデータを削除するのかを簡単に特定できるようにする。その **`data-id`** が **`localStorage`に保存されているデータのID** に一致することで、 **どのデータを削除するか** を明確に決められる。」

> 🧪 削除結果が「なんだか反映されない？」と感じたら、`removeEntryById` の最初と最後で `console.log(entries)` / `console.log(filteredEntries)` を出してみましょう。配列から本当に消えているかを目で確かめると、原因が見つかりやすくなります。

---

## 🌸 10.3 ボタンクリックのイベント処理

次に、 **削除ボタン** がクリックされたときに、どのデータを削除するのかを **特定する処理** を作成します。ここでは、クリックされた **削除ボタン** に付けられた **`data-id`** を使って、削除対象となるデータを特定します。

### **思考の軌跡** ：

「削除ボタンがクリックされたとき、 **ボタンの`data-id`を取得** して、どのエントリーを削除するかを判断しよう。」

#### **クリックイベントのコード** （削除ボタンがクリックされた時）：

```javascript
function removeButtonClick(entryId) {
    if (!entryId) {
        return;
    }

    removeEntryById(entryId); // `localStorage`から該当するデータを削除
}
```

* 削除ボタンの HTML に `onclick="removeButtonClick('ID')"` と書いておくことで、ボタンを押したタイミングで ID が渡されます。
* `removeButtonClick` は受け取った ID をそのまま削除関数 (`removeEntryById`) に渡します。削除後の再描画は `removeEntryById` 内でまとめて行っています。

### **初心者の悩み** ：

「ボタンの `onclick` に文字列を渡すのが少し不安。どうやって ID を受け取ればいいの？」

### **制作者の思考の軌跡** ：

「ボタンに埋め込んだ `onclick` から ID を受け取り、その ID を使って削除対象を特定しよう。これなら処理の流れが一目で追いやすい。」

---

## 🌸 10.4 `localStorage`からデータを削除する

削除ボタンがクリックされたら、次は **`localStorage`から削除する処理** を実行します。`localStorage`に保存されたデータは、 **IDで特定し、フィルタリングして削除** する形になります。

### **思考の軌跡** ：

「削除すべきデータを **`data-id`** で特定できたら、 **`localStorage`からそのデータを削除** し、画面に反映させるために **テーブルを再描画** しよう。」

#### **データ削除のコード** ：

```javascript
function removeEntryById(entryId) {
    const entries = loadEntriesFromStorage(); // `localStorage`からデータを取得
    const filteredEntries = entries.filter(entry => entry.id !== entryId); // 削除するID以外のデータを残す

    // 新しい配列を`localStorage`に保存
    localStorage.setItem('ichikaWorkoutLogEntries', JSON.stringify(filteredEntries));
}
```

* **`filter()`** メソッドを使って、削除対象のデータを除外し、 **新しい配列** を作成します。
* 新しい配列を **`localStorage`に保存** することで、削除処理が反映されます。

### **初心者の悩み** ：

「 **`filter()`** メソッドがどう動くのかがわからない。」

### **制作者の思考の軌跡** ：

「 **`filter()`** メソッドは、 **条件に合ったデータ** を新しい配列に **残す** ことができる。削除したいデータは条件に **合わない** ものとして除外することで、削除処理を行う。」

---

### 🔍 **実際の `index.html` / `script.js` では…？**

完成版の `index.html` では削除ボタンに `delete-button btn btn-sm btn-outline-danger` のように、役割を示すクラスと Bootstrap の見た目用クラスがセットで付いています。そしてボタン要素には

```html
onclick="removeButtonClick('${currentEntry.id}')"
```

を直接書き込み、`script.js` 側では `removeButtonClick` がその ID を受け取って `removeEntryById` を呼ぶだけで削除が完了します。保存キーも `WORKOUT_STORAGE_KEY` という定数でまとめてあり、後から変更したくなったときも管理しやすくなっています。まずはこの章のシンプルな実装で動きを理解し、慣れてきたらクラス名の付け方や定数化、`onclick` の活用などを少しずつ取り入れてみましょうね。

## 🌸 10.5 テーブルの再描画

データが削除された後、画面に表示されている **テーブルを再描画** する必要があります。これを行うことで、削除したデータが画面から消えたことをユーザーに確認してもらえます。

### **思考の軌跡** ：

「データを削除した後、画面を更新して、削除されたデータが画面から反映されるようにしよう。」

---

## 🌼 10.6 まとめ

この章では、削除ボタンをクリックしてデータを削除するために、次の処理を実装しました：

1. **削除ボタンに`data-id`を設定** して、削除するデータを特定しました。
2. クリックされた削除ボタンから **`data-id`** を読み取り、どのエントリーを削除するかを特定しました。
3. **`filter()`** メソッドを使って、削除対象のデータを **`localStorage`から削除** し、再保存しました。
4. 最後に、削除後に **テーブルを再描画** して、削除が反映されたことを画面に表示しました。

### **重要なポイント** ：

* 削除ボタンに埋め込んだ **`data-id`** を手掛かりに、クリックされた行のデータを特定しました。
* **`filter()`** メソッドを使って削除したいデータを除外し、残ったデータを **`localStorage`に再保存** しました。
* `removeEntryById` の最後で `renderEntryTable()` を呼び出すことで、削除後の一覧が自動で更新される仕組みになっています。挙動が不安な時は、関数の冒頭と末尾にログを入れて流れを追ってみてくださいね。

次回は、 **データの編集機能** や **フィルタリング機能** を追加して、さらにアプリケーションを充実させていきます。

---

これで第10章：削除機能の実装は終了です！
